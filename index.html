<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WebGPU Shaded Particle Spheres</title>
    <style>
      html, body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #0b0f14;
      }
      body.transparent-bg {
        background-color: #0b0f14;
        background-image:
          linear-gradient(45deg, rgba(255, 255, 255, 0.08) 25%, transparent 25%),
          linear-gradient(-45deg, rgba(255, 255, 255, 0.08) 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, rgba(255, 255, 255, 0.08) 75%),
          linear-gradient(-45deg, transparent 75%, rgba(255, 255, 255, 0.08) 75%);
        background-size: 24px 24px;
        background-position: 0 0, 0 12px, 12px -12px, -12px 0px;
      }
      canvas {
        width: 100%;
        height: 100%;
        display: block;
      }
      #gizmo {
        position: absolute;
        inset: 0;
        pointer-events: auto;
        z-index: 1;
      }
      .hint {
        position: absolute;
        left: 72px;
        top: 12px;
        color: #cdd6e0;
        font: 10px/1.4 "SF Mono", Menlo, monospace;
        opacity: 0.7;
        pointer-events: none;
      }
      /* Sidebar */
      .settings-sidebar {
        position: fixed;
        left: 12px;
        bottom: 12px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 100;
      }
      .sidebar-btn {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: #9fb0c2;
        font: 600 16px/1 "SF Mono", Menlo, monospace;
        cursor: pointer;
        transition: background 120ms ease, border-color 120ms ease, color 120ms ease;
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
      }
      .sidebar-btn svg {
        width: 100%;
        height: 100%;
        pointer-events: none;
      }
      .sidebar-btn.fullscreen {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.28);
        color: #cfd8e3;
      }
      .sidebar-btn.fullscreen:hover {
        background: rgba(255, 255, 255, 0.22);
        border-color: rgba(255, 255, 255, 0.4);
      }
      .sidebar-btn.fullscreen.active {
        background: rgba(255, 255, 255, 0.35);
        border-color: rgba(255, 255, 255, 0.55);
        color: #f8fafc;
      }
      /* Focus Navigator Window */
      .focus-navigator {
        position: fixed;
        right: 16px;
        bottom: 16px;
        width: 220px;
        height: 220px;
        background: rgba(10, 15, 20, 0.85);
        border: 2px solid rgba(20, 184, 166, 0.4);
        border-radius: 12px;
        z-index: 200;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      }
      .navigator-views {
        display: flex;
        gap: 4px;
        padding: 6px 8px;
        background: rgba(0, 0, 0, 0.3);
        border-bottom: 1px solid rgba(20, 184, 166, 0.3);
      }
      .nav-view-btn {
        width: 26px;
        height: 26px;
        border-radius: 6px;
        background: rgba(20, 184, 166, 0.15);
        border: 1px solid rgba(20, 184, 166, 0.4);
        color: rgba(20, 184, 166, 0.8);
        font: bold 12px "SF Mono", Menlo, monospace;
        cursor: pointer;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .nav-view-btn:hover {
        background: rgba(20, 184, 166, 0.25);
        border-color: rgba(20, 184, 166, 0.6);
        color: rgba(20, 184, 166, 1);
      }
      .nav-view-btn.active {
        background: rgba(20, 184, 166, 0.35);
        border-color: rgba(20, 184, 166, 0.7);
        color: rgba(20, 184, 166, 1);
      }
      #navigatorCanvas {
        flex: 1;
        width: 100%;
        background: rgba(0, 0, 0, 0.2);
      }
      /* Particles - Red (top) */
      .sidebar-btn[data-panel="particles"] {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.5);
        color: #f87171;
      }
      .sidebar-btn[data-panel="particles"]:hover {
        background: rgba(239, 68, 68, 0.3);
        border-color: rgba(239, 68, 68, 0.6);
      }
      .sidebar-btn[data-panel="particles"].active {
        background: rgba(239, 68, 68, 0.35);
        border-color: rgba(239, 68, 68, 0.7);
        color: #fca5a5;
      }
      /* Emitter - Hot Pink */
      .sidebar-btn[data-panel="emitter"] {
        background: rgba(236, 72, 153, 0.2);
        border-color: rgba(236, 72, 153, 0.5);
        color: #f472b6;
      }
      .sidebar-btn[data-panel="emitter"]:hover {
        background: rgba(236, 72, 153, 0.3);
        border-color: rgba(236, 72, 153, 0.6);
      }
      .sidebar-btn[data-panel="emitter"].active {
        background: rgba(236, 72, 153, 0.35);
        border-color: rgba(236, 72, 153, 0.7);
        color: #fbcfe8;
      }
      /* Forces - Purple */
      .sidebar-btn[data-panel="forces"] {
        background: rgba(168, 85, 247, 0.2);
        border-color: rgba(168, 85, 247, 0.5);
        color: #a78bfa;
      }
      .sidebar-btn[data-panel="forces"]:hover {
        background: rgba(168, 85, 247, 0.3);
        border-color: rgba(168, 85, 247, 0.6);
      }
      .sidebar-btn[data-panel="forces"].active {
        background: rgba(168, 85, 247, 0.35);
        border-color: rgba(168, 85, 247, 0.7);
        color: #c4b5fd;
      }
      /* Shading - Blue */
      .sidebar-btn[data-panel="shading"] {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.5);
        color: #60a5fa;
      }
      .sidebar-btn[data-panel="shading"]:hover {
        background: rgba(59, 130, 246, 0.3);
        border-color: rgba(59, 130, 246, 0.6);
      }
      .sidebar-btn[data-panel="shading"].active {
        background: rgba(59, 130, 246, 0.35);
        border-color: rgba(59, 130, 246, 0.7);
        color: #bfdbfe;
      }
      /* Camera - Teal (bottom) */
      .sidebar-btn[data-panel="camera"] {
        background: rgba(20, 184, 166, 0.2);
        border-color: rgba(20, 184, 166, 0.5);
        color: #5eead4;
      }
      .sidebar-btn[data-panel="camera"]:hover {
        background: rgba(20, 184, 166, 0.3);
        border-color: rgba(20, 184, 166, 0.6);
      }
      .sidebar-btn[data-panel="camera"].active {
        background: rgba(20, 184, 166, 0.35);
        border-color: rgba(20, 184, 166, 0.7);
        color: #a7f3d0;
      }
      /* Background - Amber */
      .sidebar-btn[data-panel="background"] {
        background: rgba(245, 158, 11, 0.2);
        border-color: rgba(245, 158, 11, 0.5);
        color: #fbbf24;
      }
      .sidebar-btn[data-panel="background"]:hover {
        background: rgba(245, 158, 11, 0.3);
        border-color: rgba(245, 158, 11, 0.6);
      }
      .sidebar-btn[data-panel="background"].active {
        background: rgba(245, 158, 11, 0.35);
        border-color: rgba(245, 158, 11, 0.7);
        color: #fcd34d;
      }
      /* Animation - Lime */
      .sidebar-btn[data-panel="animation"] {
        background: rgba(132, 204, 22, 0.2);
        border-color: rgba(132, 204, 22, 0.5);
        color: #a3e635;
      }
      .sidebar-btn[data-panel="animation"]:hover {
        background: rgba(132, 204, 22, 0.3);
        border-color: rgba(132, 204, 22, 0.6);
      }
      .sidebar-btn[data-panel="animation"].active {
        background: rgba(132, 204, 22, 0.35);
        border-color: rgba(132, 204, 22, 0.7);
        color: #bef264;
      }
      /* Export - Cyan */
      .sidebar-btn[data-panel="export"] {
        background: rgba(6, 182, 212, 0.2);
        border-color: rgba(6, 182, 212, 0.5);
        color: #22d3ee;
      }
      .sidebar-btn[data-panel="export"]:hover {
        background: rgba(6, 182, 212, 0.3);
        border-color: rgba(6, 182, 212, 0.6);
      }
      .sidebar-btn[data-panel="export"].active {
        background: rgba(6, 182, 212, 0.35);
        border-color: rgba(6, 182, 212, 0.7);
        color: #67e8f9;
      }
      /* Panel container */
      .settings-panel-container {
        position: fixed;
        left: 68px;
        bottom: 12px;
        max-height: calc(100vh - 24px);
        overflow-y: auto;
        z-index: 99;
      }
      .settings-panel-container::-webkit-scrollbar {
        width: 6px;
      }
      .settings-panel-container::-webkit-scrollbar-track {
        background: transparent;
      }
      .settings-panel-container::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 3px;
      }
      .settings-panel-container .panel {
        display: none;
        width: 340px;
      }
      .settings-panel-container .panel.active {
        display: block;
      }
      .panel {
        background: rgba(255, 255, 255, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        color: #d6e0ea;
        font: 11.5px/1.3 "SF Mono", Menlo, monospace;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(16px) saturate(180%);
        -webkit-backdrop-filter: blur(16px) saturate(180%);
      }
      /* Particles - Red (top) */
      .panel[data-panel="particles"] {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.5);
      }
      /* Emitter - Hot Pink */
      .panel[data-panel="emitter"] {
        background: rgba(236, 72, 153, 0.2);
        border-color: rgba(236, 72, 153, 0.5);
      }
      /* Forces - Purple */
      .panel[data-panel="forces"] {
        background: rgba(168, 85, 247, 0.2);
        border-color: rgba(168, 85, 247, 0.5);
      }
      /* Shading - Blue */
      .panel[data-panel="shading"] {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.5);
      }
      /* Camera - Teal (bottom) */
      .panel[data-panel="camera"] {
        background: rgba(20, 184, 166, 0.2);
        border-color: rgba(20, 184, 166, 0.5);
      }
      /* Background - Amber */
      .panel[data-panel="background"] {
        background: rgba(245, 158, 11, 0.2);
        border-color: rgba(245, 158, 11, 0.5);
      }
      /* Animation - Lime */
      .panel[data-panel="animation"] {
        background: rgba(132, 204, 22, 0.2);
        border-color: rgba(132, 204, 22, 0.5);
      }
      /* Export - Cyan */
      .panel[data-panel="export"] {
        background: rgba(6, 182, 212, 0.2);
        border-color: rgba(6, 182, 212, 0.5);
      }
      .panel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        user-select: none;
        border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      }
      /* Colored panel headers */
      .panel[data-panel="particles"] .panel-header {
        border-bottom-color: rgba(239, 68, 68, 0.4);
      }
      .panel[data-panel="emitter"] .panel-header {
        border-bottom-color: rgba(236, 72, 153, 0.4);
      }
      .panel[data-panel="forces"] .panel-header {
        border-bottom-color: rgba(168, 85, 247, 0.4);
      }
      .panel[data-panel="shading"] .panel-header {
        border-bottom-color: rgba(59, 130, 246, 0.4);
      }
      .panel[data-panel="camera"] .panel-header {
        border-bottom-color: rgba(20, 184, 166, 0.4);
      }
      .panel[data-panel="background"] .panel-header {
        border-bottom-color: rgba(245, 158, 11, 0.4);
      }
      .panel[data-panel="animation"] .panel-header {
        border-bottom-color: rgba(132, 204, 22, 0.4);
      }
      .panel[data-panel="export"] .panel-header {
        border-bottom-color: rgba(6, 182, 212, 0.4);
      }
      /* Colored collapse indicators */
      .panel[data-panel="particles"] .collapse-indicator {
        border-color: rgba(239, 68, 68, 0.5);
        color: rgba(239, 68, 68, 0.9);
      }
      .panel[data-panel="particles"] .collapse-indicator:hover {
        border-color: rgba(239, 68, 68, 0.7);
        background: rgba(239, 68, 68, 0.15);
      }
      .panel[data-panel="emitter"] .collapse-indicator {
        border-color: rgba(236, 72, 153, 0.5);
        color: rgba(236, 72, 153, 0.9);
      }
      .panel[data-panel="emitter"] .collapse-indicator:hover {
        border-color: rgba(236, 72, 153, 0.7);
        background: rgba(236, 72, 153, 0.15);
      }
      .panel[data-panel="forces"] .collapse-indicator {
        border-color: rgba(168, 85, 247, 0.5);
        color: rgba(168, 85, 247, 0.9);
      }
      .panel[data-panel="forces"] .collapse-indicator:hover {
        border-color: rgba(168, 85, 247, 0.7);
        background: rgba(168, 85, 247, 0.15);
      }
      .panel[data-panel="shading"] .collapse-indicator {
        border-color: rgba(59, 130, 246, 0.5);
        color: rgba(59, 130, 246, 0.9);
      }
      .panel[data-panel="shading"] .collapse-indicator:hover {
        border-color: rgba(59, 130, 246, 0.7);
        background: rgba(59, 130, 246, 0.15);
      }
      .panel[data-panel="camera"] .collapse-indicator {
        border-color: rgba(20, 184, 166, 0.5);
        color: rgba(20, 184, 166, 0.9);
      }
      .panel[data-panel="camera"] .collapse-indicator:hover {
        border-color: rgba(20, 184, 166, 0.7);
        background: rgba(20, 184, 166, 0.15);
      }
      .panel[data-panel="background"] .collapse-indicator {
        border-color: rgba(245, 158, 11, 0.5);
        color: rgba(245, 158, 11, 0.9);
      }
      .panel[data-panel="background"] .collapse-indicator:hover {
        border-color: rgba(245, 158, 11, 0.7);
        background: rgba(245, 158, 11, 0.15);
      }
      .panel[data-panel="animation"] .collapse-indicator {
        border-color: rgba(132, 204, 22, 0.5);
        color: rgba(132, 204, 22, 0.9);
      }
      .panel[data-panel="animation"] .collapse-indicator:hover {
        border-color: rgba(132, 204, 22, 0.7);
        background: rgba(132, 204, 22, 0.15);
      }
      .panel[data-panel="export"] .collapse-indicator {
        border-color: rgba(6, 182, 212, 0.5);
        color: rgba(6, 182, 212, 0.9);
      }
      .panel[data-panel="export"] .collapse-indicator:hover {
        border-color: rgba(6, 182, 212, 0.7);
        background: rgba(6, 182, 212, 0.15);
      }
      /* Export action buttons */
      .export-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 10px 16px;
        background: rgba(6, 182, 212, 0.15);
        border: 2px solid rgba(6, 182, 212, 0.5);
        border-radius: 8px;
        color: #22d3ee;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 150ms ease;
      }
      .export-btn:hover {
        background: rgba(6, 182, 212, 0.25);
        border-color: rgba(6, 182, 212, 0.7);
      }
      .export-btn:active {
        background: rgba(6, 182, 212, 0.35);
        transform: scale(0.98);
      }
      .export-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .export-btn svg {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
      }
      .export-btn.recording {
        background: rgba(239, 68, 68, 0.25);
        border-color: rgba(239, 68, 68, 0.7);
        color: #f87171;
        animation: recording-pulse 1.5s ease-in-out infinite;
      }
      @keyframes recording-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      .export-btn-row {
        display: flex;
        gap: 8px;
      }
      .export-btn-row .export-btn {
        flex: 1;
      }
      .export-status {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.7);
        text-align: center;
        padding: 4px 0;
        min-height: 20px;
      }
      .export-progress {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        overflow: hidden;
        margin-top: 4px;
      }
      .export-progress-bar {
        height: 100%;
        background: #22d3ee;
        border-radius: 2px;
        transition: width 100ms ease;
        width: 0%;
      }
      .panel-header span {
        font-weight: 600;
        letter-spacing: 0.02em;
      }
      .panel-content {
        padding: 12px 14px 16px;
        display: grid;
        gap: 12px;
      }
      .control {
        display: grid;
        gap: 7px;
      }
      #softnessControl {
        display: grid;
        gap: 7px;
        margin-top: 6px;
      }
      #sphereDetailControl {
        display: grid;
        gap: 7px;
        margin-top: 6px;
      }
      .slider-with-reset,
      .slider-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .slider-with-reset input[type="range"],
      .slider-row input[type="range"] {
        flex: 1;
        min-width: 0;
      }
      .slider-with-reset .reset-btn,
      .slider-row .reset-btn {
        flex-shrink: 0;
      }
      .control.control-shape .control-body,
      .control.control-shape .control-body.range-body {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }
      .control.control-shape #softnessControl {
        margin-top: 0;
      }
      .inline-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
      }
      .inline-toggle label {
        flex: 1;
      }
      #wireframeColorControls {
        margin-top: 10px;
        padding-left: 12px;
        border-left: 2px solid rgba(255, 255, 255, 0.15);
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      #wireframeColorPicker {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      #wireframeColorPicker label {
        flex: 1;
        min-width: 0;
        white-space: normal;
      }
	      .inline-toggle .pill-toggle {
	        margin-left: auto;
	        min-width: 54px;
	      }
	      .mini-btn-group {
	        display: inline-flex;
	        align-items: center;
	        gap: 6px;
	        margin-left: auto;
	      }
	      .mini-btn {
	        width: 22px;
	        height: 22px;
	        border-radius: 6px;
	        border: 1px solid rgba(255, 255, 255, 0.18);
	        background: rgba(255, 255, 255, 0.08);
	        color: rgba(220, 232, 244, 0.9);
	        font: 12px/1 "SF Mono", Menlo, monospace;
	        cursor: pointer;
	        padding: 0;
	      }
	      .mini-btn:hover {
	        background: rgba(255, 255, 255, 0.14);
	        border-color: rgba(255, 255, 255, 0.26);
	      }
	      .mini-btn:disabled {
	        opacity: 0.45;
	        cursor: default;
	      }
      .select-control {
        margin-bottom: 0;
      }
      .control-stack {
        display: grid;
        gap: 12px;
      }
      #turbulenceControls,
      #curlControls {
        display: grid;
        gap: 7px;
        width: 100%;
      }
      /* Main toggle control-stacks (Forces, Shading, Camera) - transparent container */
      #forcesControls,
      #shadingControls,
      #dofControls,
      #turbulenceControls,
      #curlControls,
      #vortexControls,
      #attractorControls,
      #groundControls {
        background: transparent;
        border: none;
        padding: 0;
      }
      /* Hide controls when parent has hidden-controls class */
      .hidden-controls {
        display: none !important;
      }
      .control label {
        display: flex;
        align-items: center;
        font-size: 10.5px;
        color: #9fb0c2;
      }
      .setting > label {
        cursor: pointer;
      }
      .label-left {
        display: inline-flex;
        align-items: center;
        gap: 7px;
        flex: 1;
        min-width: 0;
      }
      .collapse-indicator {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        font-size: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 120ms ease;
        padding: 0;
        margin: 0;
        flex-shrink: 0;
        box-sizing: border-box;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        vertical-align: middle;
        line-height: 1;
      }
      .collapse-indicator span {
        display: block;
        margin-top: -2px;
      }
      .collapse-indicator:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.4);
      }
      .setting.expanded .collapse-indicator {
        /* Text changes handled by JS */
      }
      .setting .control-body {
        display: none;
        gap: 7px;
      }
      .setting.expanded .control-body {
        display: flex;
        flex-direction: column;
        gap: 7px;
      }
      .setting.expanded .control.control-shape .control-body.range-body {
        display: flex;
        flex-direction: column;
        grid-template-columns: none;
        align-items: stretch;
      }
      .setting.expanded .control-body.range-body > label,
      .setting.expanded .control-body.range-body > canvas,
      .setting.expanded .control-body.range-body > .curve-editor,
      .setting.expanded .control-body.range-body > .gradient-editor {
        grid-column: 1 / -1;
        width: 100%;
      }
      /* Value display in label - right aligned */
      .setting > label span[id$="Val"] {
        margin-left: auto;
        font-weight: 600;
        opacity: 0.9;
      }
      .setting:not(.expanded) > label span[id$="Val"] {
        display: none;
      }
      .control-shape.setting:not(.expanded) select,
      .control-shape.setting:not(.expanded) #softnessControl,
      .control-shape.setting:not(.expanded) #sphereDetailControl {
        display: none;
      }
      .control-shape.setting:not(.expanded) {
        gap: 0;
      }
      .control-shape.setting:not(.expanded) .control-body {
        display: none;
        height: 0;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      .editable-value {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-left: auto;
        padding: 1px 6px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.08);
        color: #d6e0ea;
        cursor: text;
        min-width: 36px;
      }
      input.editable-value {
        display: inline-block;
        width: 64px;
        text-align: right;
        border: 1px solid rgba(255, 255, 255, 0.12);
        font: inherit;
        font-size: 10.5px;
        line-height: 1.2;
        outline: none;
      }
      .editable-value.editing {
        background: rgba(255, 255, 255, 0.16);
        outline: none;
      }
      .control input[type="range"] {
        width: 100%;
      }
      .control input[type="color"] {
        width: 100%;
        height: 28px;
        border: none;
        background: transparent;
        padding: 0;
      }
      .control select {
        width: 100%;
        background: rgba(255, 255, 255, 0.08);
        color: #d6e0ea;
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 6px;
        padding: 5px 7px;
        font: 10.5px/1.2 "SF Mono", Menlo, monospace;
        text-align: left;
        text-align-last: left;
      }
      #particleShape {
        width: auto;
        min-width: 120px;
      }
      .direction-control {
        align-items: start;
      }
      .direction-values {
        display: inline-flex;
        gap: 7px;
        margin-left: 7px;
        color: #cfd8e3;
        font-size: 11px;
      }
      .rotation-group .direction-3d {
        grid-template-columns: repeat(3, 1fr);
      }
      .rotation-axis {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 7px;
      }
      .axis-label {
        font-weight: 600;
        font-size: 11px;
        opacity: 0.8;
      }
      .rotation-axis .direction-wheel {
        margin: 0;
      }
      .rotation-axis .direction-values {
        font-size: 11px;
        font-weight: 600;
      }
      .rotation-axis .direction-reset {
        margin: 0;
      }
      .direction-reset {
        margin-left: 6px;
      }
      .direction-wheel {
        position: relative;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background:
          radial-gradient(circle at center, rgba(86, 156, 255, 0.2), rgba(12, 18, 26, 0.95) 60%),
          linear-gradient(transparent 49%, rgba(255, 255, 255, 0.12) 50%, transparent 51%),
          linear-gradient(90deg, transparent 49%, rgba(255, 255, 255, 0.12) 50%, transparent 51%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: inset 0 0 18px rgba(0, 0, 0, 0.45);
        justify-self: start;
        cursor: pointer;
        touch-action: none;
      }
      .direction-3d {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        align-items: start;
      }
      .direction-wheel::after {
        content: "";
        position: absolute;
        inset: 6px;
        border-radius: 50%;
        border: 1px dashed rgba(255, 255, 255, 0.12);
      }
      .direction-wheel-dot {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #56a3ff;
        border: 1px solid #0b0f14;
        box-shadow: 0 0 8px rgba(86, 156, 255, 0.6);
        transform: translate(-50%, -50%);
        /* Initial position at top (0 degrees) */
        left: 50%;
        top: 10%;
      }
      .curve-editor {
        width: 100%;
        height: 90px;
        border-radius: 8px;
        background: rgba(6, 10, 16, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.08);
        cursor: crosshair;
      }
      .gradient-editor {
        width: 100%;
        height: 36px;
        border-radius: 8px;
        background: rgba(6, 10, 16, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.08);
        cursor: pointer;
      }
      .pill-toggle {
        justify-self: start;
        min-width: 64px;
        padding: 4px 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: transparent;
        color: #cfd8e3;
        font: 11px/1.2 "SF Mono", Menlo, monospace;
        cursor: pointer;
        transition: background 120ms ease, border-color 120ms ease, color 120ms ease;
      }
      .pill-toggle[data-state="on"] {
        background: rgba(86, 156, 255, 0.85);
        border-color: rgba(86, 156, 255, 0.95);
        color: #0b0f14;
      }
      .reset-btn {
        justify-self: end;
        width: 22px;
        height: 22px;
        padding: 0;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.06);
        color: #cfd8e3;
        font: 14px/1 "SF Mono", Menlo, monospace;
        cursor: pointer;
        display: grid;
        place-items: center;
        text-align: center;
      }
      .reset-btn:hover {
        background: rgba(255, 255, 255, 0.12);
      }
      
      /* Mobile Full-Screen Settings */
      @media (max-width: 768px) {
        /* Sidebar - touch-friendly buttons */
        .settings-sidebar {
          position: fixed;
          bottom: 12px;
          left: 12px;
          flex-direction: row;
          gap: 10px;
          z-index: 1001;
          pointer-events: auto;
        }
        .sidebar-btn {
          width: 44px;
          height: 44px;
          font-size: 18px;
          pointer-events: auto;
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
        }
        
        /* Panel container - anchored to bottom left */
        .settings-panel-container {
          position: fixed;
          left: 0;
          bottom: 72px;
          right: 0;
          display: flex;
          align-items: flex-end;
          justify-content: flex-start;
          padding: 12px;
          z-index: 999;
          background: transparent;
          pointer-events: none;
        }
        .settings-panel-container .panel {
          pointer-events: auto;
        }
        
        /* Panel - no background, anchored bottom left */
        .settings-panel-container .panel {
          width: auto;
          max-width: 100%;
          background: transparent !important;
          border: none !important;
          box-shadow: none;
          backdrop-filter: none;
          display: none;
          pointer-events: auto;
        }
        .settings-panel-container .panel.active {
          display: block;
          max-height: calc(100vh - 84px);
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }
        .panel-header {
          display: none;
        }
        
        /* Panel content - column, items shrink to fit, bottom aligned */
        .panel-content {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
          padding: 0;
          pointer-events: auto;
          max-height: calc(100vh - 104px);
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          overscroll-behavior: contain;
        }
        
        /* Hide other settings when one is expanded */
        .panel-content.has-expanded > *:not(.expanded):not(:has(.expanded)) {
          display: none !important;
        }
        /* Also hide non-expanded settings inside Forces/Shading/Camera control-stacks */
        #forcesControls:has(.expanded) > .setting:not(.expanded):not(:has(.expanded)),
        #shadingControls:has(.expanded) > .setting:not(.expanded):not(:has(.expanded)),
        #dofControls:has(.expanded) > .setting:not(.expanded):not(:has(.expanded)),
        #turbulenceControls:has(.expanded) > .setting:not(.expanded),
        #curlControls:has(.expanded) > .setting:not(.expanded),
        #vortexControls:has(.expanded) > .setting:not(.expanded),
        #attractorControls:has(.expanded) > .setting:not(.expanded),
        #groundControls:has(.expanded) > .setting:not(.expanded),
        #emitterAnimControls:has(.expanded) > .setting:not(.expanded),
        #vortexAnimControls:has(.expanded) > .setting:not(.expanded),
        #attractorAnimControls:has(.expanded) > .setting:not(.expanded) {
          display: none !important;
        }
        
        /* Control layout - each control is a mini-panel */
        .panel-content > .control {
          display: inline-flex;
          flex-direction: column;
          gap: 10px;
          width: auto;
          background: rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.15);
          border-radius: 10px;
          padding: 10px 14px;
        }
        /* Control colors per category */
        .panel[data-panel="particles"] > .panel-content > .control {
          border-color: rgba(239, 68, 68, 0.3);
          background: rgba(239, 68, 68, 0.08);
        }
        .panel[data-panel="emitter"] > .panel-content > .control {
          border-color: rgba(236, 72, 153, 0.3);
          background: rgba(236, 72, 153, 0.08);
        }
        .panel[data-panel="forces"] > .panel-content > .control {
          border-color: rgba(168, 85, 247, 0.3);
          background: rgba(168, 85, 247, 0.08);
        }
        .panel[data-panel="shading"] > .panel-content > .control {
          border-color: rgba(59, 130, 246, 0.3);
          background: rgba(59, 130, 246, 0.08);
        }
        .panel[data-panel="camera"] > .panel-content > .control {
          border-color: rgba(20, 184, 166, 0.3);
          background: rgba(20, 184, 166, 0.08);
        }
        .panel[data-panel="background"] > .panel-content > .control {
          border-color: rgba(245, 158, 11, 0.3);
          background: rgba(245, 158, 11, 0.08);
        }
        .panel[data-panel="animation"] > .panel-content > .control {
          border-color: rgba(132, 204, 22, 0.3);
          background: rgba(132, 204, 22, 0.08);
        }
        .panel[data-panel="export"] > .panel-content > .control {
          border-color: rgba(6, 182, 212, 0.3);
          background: rgba(6, 182, 212, 0.08);
        }
        /* Nested controls (inside control-body, control-stack) - no panel styling */
        .control-body .control,
        .control-stack .control {
          padding: 0;
          background: transparent !important;
          border: none !important;
          backdrop-filter: none;
          -webkit-backdrop-filter: none;
          border-radius: 0;
        }
        
        /* Labels - readable size */
        .control label {
          font-size: 14px;
          font-weight: 500;
          min-height: 32px;
          display: flex;
          align-items: center;
          justify-content: space-between;
          width: 100%;
          letter-spacing: 0.3px;
          gap: 12px;
        }
        /* Setting labels - name on left, + button on right */
        .setting > label {
          font-size: 15px;
          font-weight: 600;
        }
        .setting > label .label-left {
          flex: 1;
          display: flex;
          align-items: center;
          gap: 16px;
        }
        /* Value spans within labels - right aligned */
        .control label > span {
          font-weight: 600;
          margin-left: auto;
          text-align: right;
          flex-shrink: 0;
        }
        /* Nested spans (like direction-values) */
        .control label .direction-values {
          margin-left: auto;
        }
        
        /* Range inputs - touch-friendly track and thumb */
        .control input[type="range"] {
          width: 100%;
          height: 8px;
          -webkit-appearance: none;
          appearance: none;
          background: transparent;
          border: 2px solid;
          border-radius: 4px;
          margin: 8px 0;
        }
        .control input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 28px;
          height: 28px;
          border: 3px solid;
          border-radius: 50%;
          background: transparent;
          cursor: pointer;
        }
        .control input[type="range"]::-moz-range-thumb {
          width: 28px;
          height: 28px;
          border: 3px solid;
          border-radius: 50%;
          background: transparent;
          cursor: pointer;
        }
        .control input[type="range"]::-moz-range-track {
          height: 8px;
          background: transparent;
          border: 2px solid;
          border-radius: 4px;
        }
        
        /* Color inputs - touch-friendly */
        .control input[type="color"] {
          width: 100%;
          height: 44px;
          border: 2px solid;
          border-radius: 8px;
          background: transparent;
        }
        
        /* Selects - touch-friendly */
        .control select {
          width: 100%;
          height: 44px;
          border: 2px solid;
          background: transparent;
          font-size: 14px;
          padding: 8px 12px;
          border-radius: 8px;
        }
        
        /* Direction wheels - large touch targets */
        .direction-wheel {
          width: 80px;
          height: 80px;
          background: transparent;
          border: 2px solid;
          box-shadow: none;
          flex-shrink: 0;
        }
        .direction-wheel::after {
          border: 1px dashed;
        }
        .direction-wheel-dot {
          width: 20px;
          height: 20px;
          border: 3px solid;
          background: transparent;
          box-shadow: none;
          /* Initial position at top (0 degrees) */
          left: 50%;
          top: 10%;
        }
        
        /* Reset buttons - touch target */
        .reset-btn {
          width: 44px;
          height: 44px;
          border: 2px solid;
          background: transparent;
          font-size: 18px;
          flex-shrink: 0;
        }
        
        /* Pill toggles - touch-friendly */
        .pill-toggle {
          min-width: 64px;
          height: 44px;
          border: 2px solid;
          background: transparent;
          font-size: 12px;
          padding: 8px 16px;
          border-radius: 22px;
          color: rgba(255, 255, 255, 0.6);
        }
        .pill-toggle[data-state="on"] {
          background: transparent;
          border-width: 3px;
        }
        /* Pill toggle "on" state colors per category */
        .panel[data-panel="particles"] .pill-toggle[data-state="on"] {
          color: rgba(239, 68, 68, 0.95);
          border-color: rgba(239, 68, 68, 0.7);
        }
        .panel[data-panel="emitter"] .pill-toggle[data-state="on"] {
          color: rgba(236, 72, 153, 0.95);
          border-color: rgba(236, 72, 153, 0.7);
        }
        .panel[data-panel="forces"] .pill-toggle[data-state="on"] {
          color: rgba(168, 85, 247, 0.95);
          border-color: rgba(168, 85, 247, 0.7);
        }
        .panel[data-panel="shading"] .pill-toggle[data-state="on"] {
          color: rgba(59, 130, 246, 0.95);
          border-color: rgba(59, 130, 246, 0.7);
        }
        .panel[data-panel="camera"] .pill-toggle[data-state="on"] {
          color: rgba(20, 184, 166, 0.95);
          border-color: rgba(20, 184, 166, 0.7);
        }
        .panel[data-panel="background"] .pill-toggle[data-state="on"] {
          color: rgba(245, 158, 11, 0.95);
          border-color: rgba(245, 158, 11, 0.7);
        }
        .panel[data-panel="animation"] .pill-toggle[data-state="on"] {
          color: rgba(132, 204, 22, 0.95);
          border-color: rgba(132, 204, 22, 0.7);
        }
        .panel[data-panel="export"] .pill-toggle[data-state="on"] {
          color: rgba(6, 182, 212, 0.95);
          border-color: rgba(6, 182, 212, 0.7);
        }
        
        /* Curve editors - visible size */
        .curve-editor {
          width: 100%;
          height: 80px;
          background: transparent;
          border: 2px solid;
          border-radius: 8px;
        }
        .gradient-editor {
          width: 100%;
          height: 44px;
          background: transparent;
          border: 2px solid;
          border-radius: 8px;
        }
        
        /* Rotation groups - collapsible */
        .rotation-group .direction-3d {
          display: flex;
          flex-direction: row;
          justify-content: space-around;
          gap: 16px;
          width: 100%;
          padding: 8px 0;
        }
        
        /* Rotation axis - vertical column with wheel */
        .rotation-axis {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
          flex: 1;
        }
        .rotation-axis .axis-label {
          font-size: 14px;
          font-weight: 600;
        }
        .rotation-axis .direction-values {
          font-size: 16px;
          font-weight: 700;
        }
        .rotation-axis .direction-reset {
          width: 36px;
          height: 36px;
          font-size: 16px;
          margin: 0;
        }
        .rotation-axis .direction-wheel {
          margin: 0;
        }
        
        /* Control stacks - group related controls */
        .control-stack {
          display: inline-flex;
          flex-direction: column;
          gap: 10px;
          width: auto;
          background: rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.15);
          border-radius: 10px;
          padding: 10px 14px;
        }
        .control-stack .control {
          background: transparent;
          border: none;
          padding: 0;
        }
        /* Control stack colors per category */
        .panel[data-panel="particles"] .control-stack {
          border-color: rgba(239, 68, 68, 0.3);
          background: rgba(239, 68, 68, 0.08);
        }
        .panel[data-panel="forces"] .control-stack {
          border-color: rgba(168, 85, 247, 0.3);
          background: rgba(168, 85, 247, 0.08);
        }
        .panel[data-panel="shading"] .control-stack {
          border-color: rgba(59, 130, 246, 0.3);
          background: rgba(59, 130, 246, 0.08);
        }
        .panel[data-panel="camera"] .control-stack {
          border-color: rgba(20, 184, 166, 0.3);
          background: rgba(20, 184, 166, 0.08);
        }
        .panel[data-panel="background"] .control-stack {
          border-color: rgba(245, 158, 11, 0.3);
          background: rgba(245, 158, 11, 0.08);
        }
        .panel[data-panel="animation"] .control-stack {
          border-color: rgba(132, 204, 22, 0.3);
          background: rgba(132, 204, 22, 0.08);
        }
        .panel[data-panel="export"] .control-stack {
          border-color: rgba(6, 182, 212, 0.3);
          background: rgba(6, 182, 212, 0.08);
        }
        
        /* Select controls with adjacent buttons */
        .select-control {
          display: inline-flex;
          flex-direction: row;
          flex-wrap: wrap;
          align-items: center;
          gap: 12px;
          width: auto;
          background: rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.15);
          border-radius: 10px;
          padding: 10px 14px;
        }
        .select-control label {
          width: 100%;
        }
        .select-control select {
          flex: 1;
          min-width: 0;
        }
        /* Select control colors per category */
        .panel[data-panel="particles"] .select-control {
          border-color: rgba(239, 68, 68, 0.3);
          background: rgba(239, 68, 68, 0.08);
        }
        .panel[data-panel="emitter"] .select-control {
          border-color: rgba(236, 72, 153, 0.3);
          background: rgba(236, 72, 153, 0.08);
        }
        .panel[data-panel="shading"] .select-control {
          border-color: rgba(59, 130, 246, 0.3);
          background: rgba(59, 130, 246, 0.08);
        }
        .panel[data-panel="camera"] .select-control {
          border-color: rgba(20, 184, 166, 0.3);
          background: rgba(20, 184, 166, 0.08);
        }
        .panel[data-panel="background"] .select-control {
          border-color: rgba(245, 158, 11, 0.3);
          background: rgba(245, 158, 11, 0.08);
        }
        .panel[data-panel="animation"] .select-control {
          border-color: rgba(132, 204, 22, 0.3);
          background: rgba(132, 204, 22, 0.08);
        }
        
        /* Editable values - touch-friendly inline display */
        .editable-value {
          border: 2px solid;
          background: transparent;
          min-height: 36px;
          min-width: 50px;
          padding: 6px 10px;
          font-size: 14px;
          font-weight: 600;
          border-radius: 6px;
          text-align: center;
          display: inline-flex;
          align-items: center;
          justify-content: center;
        }
        
        /* Value spans within labels */
        .control label span[id$="Val"] {
          margin-left: auto;
        }
        
        /* Collapse indicators - prominent button inside mini-panel */
        .collapse-indicator {
          width: 24px;
          height: 24px;
          border-radius: 50%;
          border: 2px solid rgba(255, 255, 255, 0.3);
          background: rgba(255, 255, 255, 0.1);
          color: rgba(255, 255, 255, 0.9);
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          transition: all 120ms ease;
          padding: 0;
          margin: 0;
          flex-shrink: 0;
          box-sizing: border-box;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          vertical-align: middle;
          line-height: 1;
        }
        .collapse-indicator span {
          display: block;
          margin-top: -2px;
        }
        .collapse-indicator:hover {
          background: rgba(255, 255, 255, 0.15);
          border-color: rgba(255, 255, 255, 0.4);
        }
        
        /* Collapsible settings - each is its own mini-panel */
        .setting {
          position: relative;
          background: rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.15);
          border-radius: 10px;
          padding: 10px 14px;
          width: 100%;
          display: block;
          box-sizing: border-box;
        }
        .setting > label {
          cursor: pointer;
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          user-select: none;
          min-height: 28px;
          padding: 0;
          display: flex;
          align-items: center;
          gap: 20px;
          white-space: nowrap;
        }
        .setting .control-body {
          display: none;
          flex-direction: column;
          gap: 12px;
          width: 100%;
          padding-top: 12px;
        }
        .setting.expanded .control-body {
          display: flex;
        }
        /* Slider rows on mobile - more gap */
        .slider-with-reset,
        .slider-row {
          gap: 10px;
        }
        /* Value in label stays visible */
        .setting > label span[id$="Val"] {
          margin-left: auto;
          font-weight: 600;
        }
        /* Mini-panel colors per category */
        .panel[data-panel="particles"] .setting {
          border-color: rgba(239, 68, 68, 0.3);
          background: rgba(239, 68, 68, 0.08);
        }
        .panel[data-panel="emitter"] .setting {
          border-color: rgba(236, 72, 153, 0.3);
          background: rgba(236, 72, 153, 0.08);
        }
        .panel[data-panel="forces"] .setting {
          border-color: rgba(168, 85, 247, 0.3);
          background: rgba(168, 85, 247, 0.08);
        }
        .panel[data-panel="shading"] .setting {
          border-color: rgba(59, 130, 246, 0.3);
          background: rgba(59, 130, 246, 0.08);
        }
        .panel[data-panel="camera"] .setting {
          border-color: rgba(20, 184, 166, 0.3);
          background: rgba(20, 184, 166, 0.08);
        }
        .panel[data-panel="animation"] .setting {
          border-color: rgba(132, 204, 22, 0.3);
          background: rgba(132, 204, 22, 0.08);
        }
        /* Nested settings inside control-body shouldn't have panel styling */
        .control-body .setting,
        .control-stack .setting:not(:first-child) {
          background: transparent;
          border: none;
          padding: 0;
          backdrop-filter: none;
          -webkit-backdrop-filter: none;
          border-radius: 0;
        }
        
        /* Main toggle control-stacks (Forces, Shading, Camera) - no group styling, individual panels */
        #forcesControls,
        #shadingControls,
        #dofControls,
        #turbulenceControls,
        #curlControls,
        #vortexControls,
        #attractorControls,
        #groundControls {
          background: transparent !important;
          border: none !important;
          padding: 0 !important;
          backdrop-filter: none !important;
          -webkit-backdrop-filter: none !important;
          gap: 8px;
        }
        /* Each setting inside main toggle stacks gets its own panel (same as Particles/Emitter) */
        #forcesControls .setting,
        #shadingControls .setting,
        #dofControls .setting {
          background: rgba(0, 0, 0, 0.3) !important;
          border: 1px solid rgba(255, 255, 255, 0.15) !important;
          border-radius: 10px !important;
          padding: 10px 14px !important;
        }
        /* Apply category colors to these panels */
        #forcesControls .setting {
          border-color: rgba(168, 85, 247, 0.3) !important;
          background: rgba(168, 85, 247, 0.08) !important;
        }
        #shadingControls .setting {
          border-color: rgba(59, 130, 246, 0.3) !important;
          background: rgba(59, 130, 246, 0.08) !important;
        }
        #dofControls .setting {
          border-color: rgba(20, 184, 166, 0.3) !important;
          background: rgba(20, 184, 166, 0.08) !important;
        }
        /* Rotation groups - style as mini-panel */
        .rotation-group {
          display: inline-block;
          width: auto;
          background: rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(255, 255, 255, 0.15);
          border-radius: 10px;
          padding: 10px 14px;
        }
        .panel[data-panel="emitter"] .rotation-group {
          border-color: rgba(236, 72, 153, 0.3);
          background: rgba(236, 72, 153, 0.08);
        }
        .panel[data-panel="forces"] .rotation-group {
          border-color: rgba(168, 85, 247, 0.3);
          background: rgba(168, 85, 247, 0.08);
        }
        
        /* === CATEGORY COLORS === */
        
        /* Particles - Red */
        .panel[data-panel="particles"] label {
          color: rgba(239, 68, 68, 0.95);
        }
        .panel[data-panel="particles"] input[type="range"],
        .panel[data-panel="particles"] input[type="color"],
        .panel[data-panel="particles"] select,
        .panel[data-panel="particles"] .direction-wheel,
        .panel[data-panel="particles"] .reset-btn,
        .panel[data-panel="particles"] .pill-toggle,
        .panel[data-panel="particles"] .curve-editor,
        .panel[data-panel="particles"] .gradient-editor,
        .panel[data-panel="particles"] .editable-value {
          border-color: rgba(239, 68, 68, 0.5);
        }
        .panel[data-panel="particles"] select {
          color: rgba(255, 231, 231, 0.98);
          -webkit-text-fill-color: rgba(255, 231, 231, 0.98);
          background: rgba(12, 8, 10, 0.45);
        }
        /* Particle Shape control - ensure proper width for select */
        .control:has(#particleShape) {
          min-width: 200px;
        }
        #particleShape {
          display: block !important;
          width: 100% !important;
          min-width: 180px !important;
          padding: 10px 12px !important;
          text-align: left;
          text-align-last: left;
          -webkit-appearance: menulist;
          appearance: menulist;
        }
        #particleShape option {
          color: #120a0d;
          background: #f5e7eb;
        }
        .panel[data-panel="particles"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="particles"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="particles"] .direction-wheel-dot {
          border-color: rgba(239, 68, 68, 0.8);
        }
        .panel[data-panel="particles"] .editable-value {
          color: rgba(239, 68, 68, 0.95);
        }
        .panel[data-panel="particles"] .collapse-indicator {
          border-color: rgba(239, 68, 68, 0.5);
          color: rgba(239, 68, 68, 0.9);
        }
        .panel[data-panel="particles"] .collapse-indicator:hover {
          border-color: rgba(239, 68, 68, 0.7);
          background: rgba(239, 68, 68, 0.15);
        }
        
        /* Emitter - Hot Pink */
        .panel[data-panel="emitter"] label {
          color: rgba(236, 72, 153, 0.95);
        }
        .panel[data-panel="emitter"] input[type="range"],
        .panel[data-panel="emitter"] input[type="color"],
        .panel[data-panel="emitter"] select,
        .panel[data-panel="emitter"] .direction-wheel,
        .panel[data-panel="emitter"] .reset-btn,
        .panel[data-panel="emitter"] .pill-toggle,
        .panel[data-panel="emitter"] .curve-editor,
        .panel[data-panel="emitter"] .gradient-editor,
        .panel[data-panel="emitter"] .editable-value {
          border-color: rgba(236, 72, 153, 0.5);
        }
        .panel[data-panel="emitter"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="emitter"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="emitter"] .direction-wheel-dot {
          border-color: rgba(236, 72, 153, 0.8);
        }
        .panel[data-panel="emitter"] .editable-value {
          color: rgba(236, 72, 153, 0.95);
        }
        .panel[data-panel="emitter"] .collapse-indicator {
          border-color: rgba(236, 72, 153, 0.5);
          color: rgba(236, 72, 153, 0.9);
        }
        .panel[data-panel="emitter"] .collapse-indicator:hover {
          border-color: rgba(236, 72, 153, 0.7);
          background: rgba(236, 72, 153, 0.15);
        }
        
        /* Forces - Purple */
        .panel[data-panel="forces"] label {
          color: rgba(168, 85, 247, 0.95);
        }
        .panel[data-panel="forces"] input[type="range"],
        .panel[data-panel="forces"] input[type="color"],
        .panel[data-panel="forces"] select,
        .panel[data-panel="forces"] .direction-wheel,
        .panel[data-panel="forces"] .reset-btn,
        .panel[data-panel="forces"] .pill-toggle,
        .panel[data-panel="forces"] .curve-editor,
        .panel[data-panel="forces"] .gradient-editor,
        .panel[data-panel="forces"] .editable-value {
          border-color: rgba(168, 85, 247, 0.5);
        }
        .panel[data-panel="forces"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="forces"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="forces"] .direction-wheel-dot {
          border-color: rgba(168, 85, 247, 0.8);
        }
        .panel[data-panel="forces"] .editable-value {
          color: rgba(168, 85, 247, 0.95);
        }
        .panel[data-panel="forces"] .collapse-indicator {
          border-color: rgba(168, 85, 247, 0.5);
          color: rgba(168, 85, 247, 0.9);
        }
        .panel[data-panel="forces"] .collapse-indicator:hover {
          border-color: rgba(168, 85, 247, 0.7);
          background: rgba(168, 85, 247, 0.15);
        }
        
        /* Shading - Blue */
        .panel[data-panel="shading"] label {
          color: rgba(59, 130, 246, 0.95);
        }
        .panel[data-panel="shading"] input[type="range"],
        .panel[data-panel="shading"] input[type="color"],
        .panel[data-panel="shading"] select,
        .panel[data-panel="shading"] .direction-wheel,
        .panel[data-panel="shading"] .reset-btn,
        .panel[data-panel="shading"] .pill-toggle,
        .panel[data-panel="shading"] .curve-editor,
        .panel[data-panel="shading"] .gradient-editor,
        .panel[data-panel="shading"] .editable-value {
          border-color: rgba(59, 130, 246, 0.5);
        }
        .panel[data-panel="shading"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="shading"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="shading"] .direction-wheel-dot {
          border-color: rgba(59, 130, 246, 0.8);
        }
        .panel[data-panel="shading"] .editable-value {
          color: rgba(59, 130, 246, 0.95);
        }
        .panel[data-panel="shading"] .collapse-indicator {
          border-color: rgba(59, 130, 246, 0.5);
          color: rgba(59, 130, 246, 0.9);
        }
        .panel[data-panel="shading"] .collapse-indicator:hover {
          border-color: rgba(59, 130, 246, 0.7);
          background: rgba(59, 130, 246, 0.15);
        }
        
        /* DoF - Teal */
        .panel[data-panel="camera"] label {
          color: rgba(20, 184, 166, 0.95);
        }
        .panel[data-panel="camera"] input[type="range"],
        .panel[data-panel="camera"] input[type="color"],
        .panel[data-panel="camera"] select,
        .panel[data-panel="camera"] .direction-wheel,
        .panel[data-panel="camera"] .reset-btn,
        .panel[data-panel="camera"] .pill-toggle,
        .panel[data-panel="camera"] .curve-editor,
        .panel[data-panel="camera"] .gradient-editor,
        .panel[data-panel="camera"] .editable-value {
          border-color: rgba(20, 184, 166, 0.5);
        }
        .panel[data-panel="camera"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="camera"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="camera"] .direction-wheel-dot {
          border-color: rgba(20, 184, 166, 0.8);
        }
        .panel[data-panel="camera"] .editable-value {
          color: rgba(20, 184, 166, 0.95);
        }
        .panel[data-panel="camera"] .collapse-indicator {
          border-color: rgba(20, 184, 166, 0.5);
          color: rgba(20, 184, 166, 0.9);
        }
        .panel[data-panel="camera"] .collapse-indicator:hover {
          border-color: rgba(20, 184, 166, 0.7);
          background: rgba(20, 184, 166, 0.15);
        }
        
        /* Background - Amber */
        .panel[data-panel="background"] label {
          color: rgba(245, 158, 11, 0.95);
        }
        .panel[data-panel="background"] input[type="range"],
        .panel[data-panel="background"] input[type="color"],
        .panel[data-panel="background"] select,
        .panel[data-panel="background"] .direction-wheel,
        .panel[data-panel="background"] .reset-btn,
        .panel[data-panel="background"] .pill-toggle,
        .panel[data-panel="background"] .curve-editor,
        .panel[data-panel="background"] .gradient-editor,
        .panel[data-panel="background"] .editable-value {
          border-color: rgba(245, 158, 11, 0.5);
        }
        .panel[data-panel="background"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="background"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="background"] .direction-wheel-dot {
          border-color: rgba(245, 158, 11, 0.8);
        }
        .panel[data-panel="background"] .editable-value {
          color: rgba(245, 158, 11, 0.95);
        }
        .panel[data-panel="background"] .collapse-indicator {
          border-color: rgba(245, 158, 11, 0.5);
          color: rgba(245, 158, 11, 0.9);
        }
        .panel[data-panel="background"] .collapse-indicator:hover {
          border-color: rgba(245, 158, 11, 0.7);
          background: rgba(245, 158, 11, 0.15);
        }
        .panel[data-panel="background"] select {
          color: rgba(255, 243, 220, 0.98);
          -webkit-text-fill-color: rgba(255, 243, 220, 0.98);
          background: rgba(12, 10, 6, 0.45);
        }
        
        /* Animation - Lime */
        .panel[data-panel="animation"] label {
          color: rgba(132, 204, 22, 0.95);
        }
        .panel[data-panel="animation"] input[type="range"],
        .panel[data-panel="animation"] input[type="color"],
        .panel[data-panel="animation"] select,
        .panel[data-panel="animation"] .direction-wheel,
        .panel[data-panel="animation"] .reset-btn,
        .panel[data-panel="animation"] .pill-toggle,
        .panel[data-panel="animation"] .curve-editor,
        .panel[data-panel="animation"] .gradient-editor,
        .panel[data-panel="animation"] .editable-value {
          border-color: rgba(132, 204, 22, 0.5);
        }
        .panel[data-panel="animation"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="animation"] input[type="range"]::-moz-range-thumb,
        .panel[data-panel="animation"] .direction-wheel-dot {
          border-color: rgba(132, 204, 22, 0.8);
        }
        .panel[data-panel="animation"] .editable-value {
          color: rgba(132, 204, 22, 0.95);
        }
        .panel[data-panel="animation"] .collapse-indicator {
          border-color: rgba(132, 204, 22, 0.5);
          color: rgba(132, 204, 22, 0.9);
        }
        .panel[data-panel="animation"] .collapse-indicator:hover {
          border-color: rgba(132, 204, 22, 0.7);
          background: rgba(132, 204, 22, 0.15);
        }
        .panel[data-panel="animation"] select {
          color: rgba(240, 255, 220, 0.98);
          -webkit-text-fill-color: rgba(240, 255, 220, 0.98);
          background: rgba(8, 12, 6, 0.45);
        }
        
        /* Export - Cyan */
        .panel[data-panel="export"] label {
          color: rgba(6, 182, 212, 0.95);
        }
        .panel[data-panel="export"] input[type="range"],
        .panel[data-panel="export"] .export-btn {
          border-color: rgba(6, 182, 212, 0.5);
        }
        .panel[data-panel="export"] input[type="range"]::-webkit-slider-thumb,
        .panel[data-panel="export"] input[type="range"]::-moz-range-thumb {
          border-color: rgba(6, 182, 212, 0.8);
        }
        .panel[data-panel="export"] .collapse-indicator {
          border-color: rgba(6, 182, 212, 0.5);
          color: rgba(6, 182, 212, 0.9);
        }
        .panel[data-panel="export"] .collapse-indicator:hover {
          border-color: rgba(6, 182, 212, 0.7);
          background: rgba(6, 182, 212, 0.15);
        }
        
        /* Focus Navigator - smaller on mobile */
        .focus-navigator {
          width: 150px;
          height: 150px;
          right: 8px;
          bottom: 70px;
        }
        .navigator-views {
          padding: 4px 6px;
          gap: 3px;
        }
        .nav-view-btn {
          width: 22px;
          height: 22px;
          font-size: 10px;
        }
      }
	      .perf-hud {
	        position: fixed;
	        right: 16px;
	        bottom: 16px;
	        z-index: 1002;
        display: grid;
        gap: 6px;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(8, 12, 16, 0.6);
        color: rgba(220, 232, 244, 0.85);
        font: 11px/1.3 "SF Mono", Menlo, monospace;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
	        pointer-events: none;
	        min-width: 120px;
	      }
	      .perf-hud[aria-hidden="true"] {
	        display: none;
	      }
      .perf-hud .label {
        color: rgba(160, 180, 200, 0.8);
        letter-spacing: 0.02em;
      }
      .perf-hud .perf-row {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .perf-hud .perf-row .label {
        min-width: 28px;
      }
      .perf-hud .perf-bar {
        flex: 1;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
      }
      .perf-hud .perf-bar-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.15s ease-out, background-color 0.15s ease-out;
        min-width: 2px;
      }
      .perf-hud .perf-value {
        min-width: 32px;
        text-align: right;
        font-size: 10px;
        opacity: 0.7;
      }
    </style>
  </head>
  <body>
    <canvas id="gfx"></canvas>
    <canvas id="gizmo"></canvas>
	    <div id="perfHud" class="perf-hud" aria-hidden="true">
	      <div class="perf-row">
	        <span class="label">HUD</span>
	        <span id="perfMode" class="perf-value">basic</span>
	      </div>
	      <div><span class="label">FPS</span> <span id="perfFps">--</span></div>
	      <div class="perf-row">
	        <span class="label">CPU</span>
	        <div class="perf-bar"><div id="perfCpuBar" class="perf-bar-fill"></div></div>
	        <span id="perfCpu" class="perf-value">--</span>
	      </div>
	      <div class="perf-row">
	        <span class="label">GPU</span>
	        <div class="perf-bar"><div id="perfGpuBar" class="perf-bar-fill"></div></div>
	        <span id="perfGpu" class="perf-value">--</span>
	      </div>
	      <div class="perf-row">
	        <span class="label">P/ms</span>
	        <span id="perfPms" class="perf-value">--</span>
	      </div>
	      <div class="perf-row">
	        <span class="label">Low</span>
	        <span id="perfLow" class="perf-value">off</span>
	      </div>
		      <div class="perf-row">
		        <span class="label">Pts</span>
		        <span id="perfParticles" class="perf-value">0</span>
		      </div>
		    </div>
    <div class="settings-sidebar">
      <button class="sidebar-btn" data-panel="particles" title="Particles">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <circle cx="6" cy="8" r="2.5"/>
          <circle cx="12" cy="5" r="1.5"/>
          <circle cx="17" cy="9" r="3"/>
          <circle cx="8" cy="15" r="1.8"/>
          <circle cx="15" cy="17" r="2.2"/>
          <circle cx="19" cy="14" r="1.2"/>
          <circle cx="4" cy="18" r="1"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="emitter" title="Emitter">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.2"/>
          <!-- Top -->
          <line x1="12" y1="9" x2="12" y2="4" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="12" cy="2.5" r="1.3"/>
          <!-- Top-right -->
          <line x1="14" y1="10" x2="18" y2="5" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="19.5" cy="3.5" r="1"/>
          <!-- Right -->
          <line x1="15" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="21.5" cy="12" r="1.2"/>
          <!-- Bottom-right -->
          <line x1="14" y1="14" x2="17" y2="18" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="18.5" cy="20" r="1.1"/>
          <!-- Bottom -->
          <line x1="12" y1="15" x2="12" y2="19" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="12" cy="21" r="1.3"/>
          <!-- Bottom-left -->
          <line x1="10" y1="14" x2="6" y2="18" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="4.5" cy="20" r="1"/>
          <!-- Left -->
          <line x1="9" y1="12" x2="4" y2="12" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="2.5" cy="12" r="1.2"/>
          <!-- Top-left -->
          <line x1="10" y1="10" x2="6" y2="5" stroke="currentColor" stroke-width="0.8" opacity="0.5"/>
          <circle cx="4.5" cy="3.5" r="1.1"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="forces" title="Forces">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
          <path d="M2 6h12c2 0 3.5-1.5 3.5-3.5S15 0 13 1"/>
          <path d="M2 12h16c2.5 0 4 2 4 4s-2 3-4 2"/>
          <path d="M2 18h8c1.5 0 2.5 1 2.5 2.5s-1.5 2-3 1"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="shading" title="Shading">
        <svg viewBox="0 0 24 24">
          <defs>
            <linearGradient id="shadeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="currentColor" stop-opacity="1"/>
              <stop offset="50%" stop-color="currentColor" stop-opacity="1"/>
              <stop offset="50%" stop-color="currentColor" stop-opacity="0.25"/>
              <stop offset="100%" stop-color="currentColor" stop-opacity="0.25"/>
            </linearGradient>
          </defs>
          <circle cx="12" cy="12" r="9" fill="url(#shadeGrad)"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="camera" title="Camera">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="7" cy="8" r="2.3"/>
          <circle cx="12" cy="6.5" r="2.3"/>
          <rect x="5" y="10" width="10" height="7" rx="1.5"/>
          <path d="M15 12l4-2v8l-4-2z"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="background" title="Background">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M3 15l5-5 4 4 5-5 4 4"/>
          <circle cx="8" cy="8" r="1.5" fill="currentColor"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="animation" title="Animation">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round">
          <path d="M4 12h2"/>
          <path d="M18 12h2"/>
          <path d="M12 4v2"/>
          <path d="M12 18v2"/>
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 12l4-4" stroke-dasharray="2 2"/>
          <circle cx="16" cy="8" r="1.5" fill="currentColor"/>
        </svg>
      </button>
      <button class="sidebar-btn" data-panel="export" title="Export">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
      </button>
      <button id="fullscreenToggle" class="sidebar-btn fullscreen" title="Fullscreen" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round">
          <path d="M8 3H3v5"/>
          <path d="M16 3h5v5"/>
          <path d="M21 16v5h-5"/>
          <path d="M3 16v5h5"/>
        </svg>
      </button>
    </div>
    <div class="settings-panel-container">
      <div class="panel" data-panel="particles">
        <div class="panel-header">
          <span>Particles</span>
        </div>
        <div class="panel-content">
          <div class="control control-shape">
            <label>Particle Shape</label>
            <select id="particleShape">
              <option value="circle">Circle (2D)</option>
              <option value="square">Square (2D)</option>
              <option value="cube">Cube (3D)</option>
              <option value="sphere">Sphere (3D)</option>
              <option value="icosahedron">Icosahedron (3D)</option>
            </select>
            <div id="softnessControl">
              <label for="softness">Particle Softness <span id="softnessVal"></span></label>
              <div class="slider-with-reset">
                <input id="softness" type="range" min="0" max="1" step="0.05" data-default="0" />
                <button id="softnessReset" type="button" class="reset-btn"></button>
          </div>
            </div>
            <div id="sphereDetailControl">
              <label for="sphereDetail">Sphere Detail (Subdivisions) <span id="sphereDetailVal"></span></label>
              <div class="slider-with-reset">
                <input id="sphereDetail" type="range" min="0" max="6" step="1" data-default="2" />
                <button id="sphereDetailReset" type="button" class="reset-btn"></button>
          </div>
            </div>
            </div>
          <div class="control">
            <label>Particle Life</label>
            <label for="lifeSeconds">Life (sec) <span id="lifeSecondsVal"></span></label>
            <input id="lifeSeconds" type="range" min="0.4" max="100" step="0.1" data-default="2.0" />
            <label for="lifeRandom">Life Random <span id="lifeRandomVal"></span></label>
            <input id="lifeRandom" type="range" min="0" max="1" step="0.05" data-default="0" />
          </div>
          <div class="control">
            <label>Particle Size</label>
            <label for="particleSize">Size <span id="particleSizeVal"></span></label>
            <input id="particleSize" type="range" min="1" max="100" step="1" data-default="1" />
            <label for="sizeRandom">Size Random <span id="sizeRandomVal"></span></label>
            <input id="sizeRandom" type="range" min="0" max="1" step="0.05" data-default="0" />
            <label for="sizeCurveCanvas">Size Curve</label>
            <canvas id="sizeCurveCanvas" class="curve-editor" width="240" height="90"></canvas>
          </div>
          <div class="control">
            <label>Particle Color</label>
            <label for="colorMode">Color Mode</label>
            <select id="colorMode">
              <option value="gradient">Gradient Over Life</option>
              <option value="random">Random From Gradient</option>
              <option value="solid">Solid Color</option>
            </select>
	            <div id="gradientControl">
	              <div class="inline-toggle">
	                <label for="colorGradientCanvas">Color Gradient</label>
	                <div class="mini-btn-group">
	                  <button type="button" class="mini-btn" data-gradient="colorGradientCanvas" data-action="add" aria-label="Add gradient point">+</button>
	                  <button type="button" class="mini-btn" data-gradient="colorGradientCanvas" data-action="remove" aria-label="Delete selected gradient point"></button>
	                </div>
	              </div>
	              <canvas id="colorGradientCanvas" class="gradient-editor" width="240" height="36"></canvas>
	          </div>
            <div id="solidColorControl">
            <label for="solidColor">Solid Color <span id="solidColorVal"></span></label>
            <input id="solidColor" type="color" />
          </div>
            <label for="blendMode">Blend Mode</label>
            <select id="blendMode">
              <option value="alpha">Normal</option>
              <option value="additive">Add</option>
              <option value="screen">Screen</option>
              <option value="multiply">Multiply</option>
            </select>
          </div>
          <div class="control">
            <label>Particle Opacity</label>
            <label for="particleOpacity">Opacity <span id="particleOpacityVal"></span></label>
            <input id="particleOpacity" type="range" min="0" max="1" step="0.01" data-default="1" />
            <label for="opacityCurveCanvas">Opacity Curve</label>
            <canvas id="opacityCurveCanvas" class="curve-editor" width="240" height="90"></canvas>
          </div>
        </div>
      </div>

      <div class="panel" data-panel="emitter">
        <div class="panel-header">
          <span>Emitter</span>
        </div>
        <div class="panel-content">
          <div class="control select-control">
            <label for="emitterShape">Emitter Shape</label>
            <select id="emitterShape">
              <option value="point">Point</option>
              <option value="sphere">Sphere</option>
              <option value="box">Box</option>
              <option value="plane">Plane</option>
              <option value="line">Line</option>
            </select>
          </div>
          <div id="emitterShapeControls" class="control-stack">
            <div class="control shape-only">
              <label for="emitterSize">Emitter Size <span id="emitterSizeVal"></span></label>
              <input id="emitterSize" type="range" min="0" max="1" step="0.02" data-default="0.2" />
          </div>
          <div class="control select-control shape-only">
            <label for="emitFrom">Emit From</label>
            <select id="emitFrom">
              <option value="volume">Volume</option>
              <option value="edge">Edge</option>
            </select>
          </div>
          <div class="control">
            <label for="emissionRate">Emission Rate <span id="emissionRateVal"></span></label>
            <input id="emissionRate" type="range" min="0" max="20000" step="1" data-default="40" />
          </div>
          <div class="control">
            <label>Emitter Position</label>
            <label for="emitterPosX">X <span id="emitterPosXVal"></span></label>
            <input id="emitterPosX" type="range" min="-2" max="2" step="0.05" data-default="0" />
            <label for="emitterPosY">Y <span id="emitterPosYVal"></span></label>
            <input id="emitterPosY" type="range" min="-2" max="2" step="0.05" data-default="0" />
            <label for="emitterPosZ">Z <span id="emitterPosZVal"></span></label>
            <input id="emitterPosZ" type="range" min="-2" max="2" step="0.05" data-default="0" />
            <div class="inline-toggle">
              <label for="emitterGizmo">Show Emitter Gizmo</label>
              <button id="emitterGizmo" class="pill-toggle" type="button" data-state="off">Off</button>
            </div>
          </div>
          <div class="control rotation-group">
            <label>Emitter Rotation</label>
          <div id="direction3dControls" class="direction-3d">
              <div class="rotation-axis">
                <span class="axis-label">X</span>
              <div id="directionXWheel" class="direction-wheel" role="slider" aria-label="Rotate X">
                <div id="directionXDot" class="direction-wheel-dot"></div>
              </div>
                <span class="direction-values"><span id="directionXVal"></span></span>
                <button id="directionXReset" type="button" class="reset-btn direction-reset"></button>
            </div>
              <div class="rotation-axis">
                <span class="axis-label">Y</span>
              <div id="directionYWheel" class="direction-wheel" role="slider" aria-label="Rotate Y">
                <div id="directionYDot" class="direction-wheel-dot"></div>
              </div>
                <span class="direction-values"><span id="directionYVal"></span></span>
                <button id="directionYReset" type="button" class="reset-btn direction-reset"></button>
            </div>
              <div class="rotation-axis">
                <span class="axis-label">Z</span>
              <div id="directionZWheel" class="direction-wheel" role="slider" aria-label="Rotate Z">
                <div id="directionZDot" class="direction-wheel-dot"></div>
                </div>
                <span class="direction-values"><span id="directionZVal"></span></span>
                <button id="directionZReset" type="button" class="reset-btn direction-reset"></button>
              </div>
            </div>
          </div>
          <div class="control">
            <label for="emissionDirection">Emission Direction</label>
            <select id="emissionDirection">
              <option value="directional">Directional</option>
              <option value="outwards">Outwards</option>
              <option value="bidirectional">Bi-directional</option>
            </select>
          </div>
          <div class="control">
            <label>Particle Velocity</label>
            <label for="initialSpeed">Velocity <span id="initialSpeedVal"></span></label>
            <input id="initialSpeed" type="range" min="0" max="3" step="0.1" data-default="1" />
            <label for="speedRandom">Velocity Random <span id="speedRandomVal"></span></label>
            <input id="speedRandom" type="range" min="0" max="1" step="0.05" data-default="0.2" />
          </div>
          </div>
          <div class="control">
            <label for="coneAngle">Emission Angle <span id="coneAngleVal"></span></label>
            <input id="coneAngle" type="range" min="0" max="90" step="1" data-default="16" />
          </div>
          <div class="control">
            <label>Particle Spin</label>
            <div id="spin2dControls">
              <label for="spinRate2d">Spin Rate <span id="spinRate2dVal"></span></label>
              <input id="spinRate2d" type="range" min="-6" max="6" step="0.1" data-default="1.2" />
            </div>
            <div id="spin3dControls">
              <label for="spinRateX">Spin X <span id="spinRateXVal"></span></label>
              <input id="spinRateX" type="range" min="-6" max="6" step="0.1" data-default="1.2" />
              <label for="spinRateY">Spin Y <span id="spinRateYVal"></span></label>
              <input id="spinRateY" type="range" min="-6" max="6" step="0.1" data-default="1.2" />
              <label for="spinRateZ">Spin Z <span id="spinRateZVal"></span></label>
              <input id="spinRateZ" type="range" min="-6" max="6" step="0.1" data-default="1.2" />
            </div>
            <label for="spinRandom">Spin Random <span id="spinRandomVal"></span></label>
            <input id="spinRandom" type="range" min="0" max="2" step="0.1" data-default="0.4" />
          </div>
        </div>
      </div>

	      <div class="panel" data-panel="forces">
	        <div class="panel-header">
	          <span>Forces</span>
	        </div>
	        <div class="panel-content">
	          <div id="forcesControls" class="control-stack">
	            <div class="control">
		              <div class="inline-toggle">
		                <label for="noiseEnabled">Noise</label>
		                <button id="noiseEnabled" class="pill-toggle" type="button" data-state="on">On</button>
		              </div>
	              <div id="noiseControls">
	                <label for="forceMode">Noise Mode</label>
	                <select id="forceMode">
	                  <option value="turbulence">Turbulence</option>
	                  <option value="curl">Curl Noise</option>
	                </select>
	                <div id="turbulenceControls">
	                  <label for="turbulence">Turbulence <span id="turbulenceVal"></span></label>
	                  <input id="turbulence" type="range" min="0" max="100" step="0.1" data-default="1.2" />
	                  <label for="turbulenceScale">Turbulence Scale <span id="turbulenceScaleVal"></span></label>
	                  <input id="turbulenceScale" type="range" min="0.1" max="100" step="0.1" data-default="0.8" />
	                </div>
	                <div id="curlControls">
	                  <label for="curlStrength">Curl Strength <span id="curlStrengthVal"></span></label>
	                  <input id="curlStrength" type="range" min="0" max="100" step="0.1" data-default="1.2" />
	                  <label for="curlScale">Curl Scale <span id="curlScaleVal"></span></label>
	                  <input id="curlScale" type="range" min="0.1" max="100" step="0.1" data-default="0.8" />
	                </div>
	              </div>
	            </div>
	            <div class="control">
	              <div class="inline-toggle">
	                <label for="vortexEnabled">Vortex</label>
	                <button id="vortexEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
	              </div>
	            </div>
            <div id="vortexControls" class="control-stack">
            <div class="control">
              <label for="vortexStrength">Vortex Strength <span id="vortexStrengthVal"></span></label>
              <input id="vortexStrength" type="range" min="0" max="100" step="0.1" data-default="1.8" />
            </div>
            <div class="control">
              <label for="vortexRadius">Vortex Radius <span id="vortexRadiusVal"></span></label>
              <input id="vortexRadius" type="range" min="0.1" max="100" step="0.1" data-default="1.5" />
            </div>
            <div class="control">
                <label>Vortex Position</label>
                <label for="vortexPosX">X <span id="vortexPosXVal"></span></label>
              <input id="vortexPosX" type="range" min="-2" max="2" step="0.05" data-default="0" />
                <label for="vortexPosY">Y <span id="vortexPosYVal"></span></label>
              <input id="vortexPosY" type="range" min="-2" max="2" step="0.05" data-default="0" />
                <label for="vortexPosZ">Z <span id="vortexPosZVal"></span></label>
              <input id="vortexPosZ" type="range" min="-2" max="2" step="0.05" data-default="0" />
                <div class="inline-toggle">
                  <label for="vortexGizmo">Show Vortex Gizmo</label>
                  <button id="vortexGizmo" class="pill-toggle" type="button" data-state="off">Off</button>
            </div>
              </div>
              <div class="control rotation-group">
                <label>Vortex Rotation</label>
            <div class="direction-3d">
                  <div class="rotation-axis">
                    <span class="axis-label">X</span>
                <div id="vortexRotXWheel" class="direction-wheel" role="slider" aria-label="Rotate vortex X">
                  <div id="vortexRotXDot" class="direction-wheel-dot"></div>
                </div>
                    <span class="direction-values"><span id="vortexRotXVal"></span></span>
                    <button id="vortexRotXReset" type="button" class="reset-btn direction-reset"></button>
              </div>
                  <div class="rotation-axis">
                    <span class="axis-label">Y</span>
                <div id="vortexRotYWheel" class="direction-wheel" role="slider" aria-label="Rotate vortex Y">
                  <div id="vortexRotYDot" class="direction-wheel-dot"></div>
                </div>
                    <span class="direction-values"><span id="vortexRotYVal"></span></span>
                    <button id="vortexRotYReset" type="button" class="reset-btn direction-reset"></button>
              </div>
                  <div class="rotation-axis">
                    <span class="axis-label">Z</span>
                <div id="vortexRotZWheel" class="direction-wheel" role="slider" aria-label="Rotate vortex Z">
                  <div id="vortexRotZDot" class="direction-wheel-dot"></div>
                    </div>
                    <span class="direction-values"><span id="vortexRotZVal"></span></span>
                    <button id="vortexRotZReset" type="button" class="reset-btn direction-reset"></button>
                </div>
              </div>
            </div>
          </div>
		            <div class="control">
		              <div class="inline-toggle">
		                <label for="attractorEnabled">Attractor</label>
		                <button id="attractorEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
		              </div>
		            </div>
	            <div id="attractorControls" class="control-stack">
	              <div class="control">
	                <label for="attractorStrength">Attractor Strength <span id="attractorStrengthVal"></span></label>
	                <input id="attractorStrength" type="range" min="0" max="100" step="0.1" data-default="0" />
	              </div>
	              <div class="control">
	                <label for="attractorRadius">Attractor Radius <span id="attractorRadiusVal"></span></label>
	                <input id="attractorRadius" type="range" min="0" max="100" step="0.1" data-default="0" />
	              </div>
	              <div id="attractorPositionPanel" class="control">
	                <label>Attractor Position</label>
	                <label for="attractorPosX">X <span id="attractorPosXVal"></span></label>
	                  <input id="attractorPosX" type="range" min="-2" max="2" step="0.05" data-default="0" />
	                <label for="attractorPosY">Y <span id="attractorPosYVal"></span></label>
	                  <input id="attractorPosY" type="range" min="-2" max="2" step="0.05" data-default="0" />
	                <label for="attractorPosZ">Z <span id="attractorPosZVal"></span></label>
	                  <input id="attractorPosZ" type="range" min="-2" max="2" step="0.05" data-default="0" />
	                <div class="inline-toggle">
	                  <label for="attractorGizmo">Show Attractor Gizmo</label>
	                  <button id="attractorGizmo" class="pill-toggle" type="button" data-state="off">Off</button>
	                </div>
	              </div>
	            </div>
            <div class="control">
              <label for="gravity">Gravity <span id="gravityVal"></span></label>
              <input id="gravity" type="range" min="-100" max="100" step="0.1" data-default="-0.2" />
            </div>
            <div class="control">
              <label>Wind</label>
              <label for="windX">X <span id="windXVal"></span></label>
              <input id="windX" type="range" min="-100" max="100" step="0.1" data-default="0" />
              <label for="windY">Y <span id="windYVal"></span></label>
              <input id="windY" type="range" min="-100" max="100" step="0.1" data-default="0" />
              <label for="windZ">Z <span id="windZVal"></span></label>
              <input id="windZ" type="range" min="-100" max="100" step="0.1" data-default="0" />
            </div>
            <div class="control">
              <label for="drag">Drag <span id="dragVal"></span></label>
              <input id="drag" type="range" min="0" max="100" step="0.1" data-default="0" />
            </div>
	            <div class="control">
	              <div class="inline-toggle">
	                <label for="groundEnabled">Ground Collision</label>
	                <button id="groundEnabled" class="pill-toggle" type="button" data-state="on">On</button>
	              </div>
	            </div>
            <div id="groundControls" class="control-stack">
              <div class="control">
                <label for="groundLevel">Ground Level <span id="groundLevelVal"></span></label>
                <input id="groundLevel" type="range" min="-2" max="2" step="0.1" data-default="-1" />
              </div>
              <div class="control">
                <label for="bounce">Bounce <span id="bounceVal"></span></label>
                <input id="bounce" type="range" min="0" max="1" step="0.05" data-default="0.2" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel" data-panel="shading">
        <div class="panel-header">
          <span>Shading</span>
        </div>
        <div class="panel-content">
	          <div class="control">
	            <div class="inline-toggle">
	              <label for="shadingEnabled">Shading</label>
	              <button id="shadingEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
	            </div>
	          </div>
          <div id="shadingControls" class="control-stack hidden-controls">
            <div class="inline-toggle" style="margin-bottom: 10px;">
              <label for="surfaceEnabled">Surface</label>
              <button id="surfaceEnabled" class="pill-toggle" type="button" data-state="on">On</button>
            </div>
            <div class="inline-toggle" style="margin-bottom: 6px;">
              <label for="wireframeEnabled">Wireframe</label>
              <button id="wireframeEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
            </div>
            <div id="wireframeColorControls" style="display: none; margin-bottom: 10px; padding-left: 12px; border-left: 2px solid rgba(255,255,255,0.15);">
              <div class="inline-toggle" style="margin-bottom: 6px;">
                <label for="wireframeSameColor">Same as particle color</label>
                <button id="wireframeSameColor" class="pill-toggle" type="button" data-state="on">On</button>
              </div>
              <div id="wireframeColorPicker" style="display: none;">
                <label for="wireframeColor" style="margin-right: 10px;">Wireframe Color</label>
                <input id="wireframeColor" type="color" value="#ffffff" />
              </div>
            </div>
            <div class="control">
              <label>Light Position</label>
              <label for="lightPosX">X <span id="lightPosXVal"></span></label>
              <input id="lightPosX" type="range" min="-2" max="2" step="0.05" data-default="0" />
              <label for="lightPosY">Y <span id="lightPosYVal"></span></label>
              <input id="lightPosY" type="range" min="-2" max="2" step="0.05" data-default="1" />
              <label for="lightPosZ">Z <span id="lightPosZVal"></span></label>
              <input id="lightPosZ" type="range" min="-2" max="2" step="0.05" data-default="0.3" />
              <div class="inline-toggle">
                <label for="lightGizmo">Show Light Gizmo</label>
                <button id="lightGizmo" class="pill-toggle" type="button" data-state="off">Off</button>
              </div>
            </div>
	            <div class="control">
	              <label for="baseColor">Light Color <input id="baseColorVal" class="editable-value" type="text" inputmode="text" autocomplete="off" spellcheck="false" /></label>
	              <input id="baseColor" type="color" />
	            </div>
            <div class="control">
              <label for="lightIntensity">Light Intensity <span id="lightIntensityVal"></span></label>
              <input id="lightIntensity" type="range" min="0" max="3" step="0.1" data-default="1.2" />
            </div>
            <div class="control">
              <label for="shadingStyle">Shading Style</label>
              <select id="shadingStyle">
                <option value="smooth">Smooth</option>
                <option value="flat">Flat (Faceted)</option>
              </select>
            </div>
            <div class="control">
              <label for="rimIntensity">Rim Lighting <span id="rimIntensityVal"></span></label>
              <input id="rimIntensity" type="range" min="0" max="2" step="0.05" data-default="0.4" />
            </div>
            <div class="control">
              <label for="specIntensity">Specular <span id="specIntensityVal"></span></label>
              <input id="specIntensity" type="range" min="0" max="2" step="0.05" data-default="0.3" />
            </div>
          </div>
        </div>
      </div>

      <div class="panel" data-panel="camera">
        <div class="panel-header">
          <span>Camera</span>
        </div>
        <div class="panel-content">
          <div id="dofControls" class="control-stack">
	            <div class="control">
	              <div class="inline-toggle">
	                <label for="cameraViewEnabled">Camera View</label>
	                <button id="cameraViewEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
	              </div>
	            </div>
            <div class="control">
              <label>Camera Position</label>
              <label for="cameraPosX">X <span id="cameraPosXVal"></span></label>
              <input id="cameraPosX" type="range" min="-10" max="10" step="0.1" data-default="0" />
              <label for="cameraPosY">Y <span id="cameraPosYVal"></span></label>
              <input id="cameraPosY" type="range" min="-10" max="10" step="0.1" data-default="0.4" />
              <label for="cameraPosZ">Z <span id="cameraPosZVal"></span></label>
              <input id="cameraPosZ" type="range" min="-10" max="10" step="0.1" data-default="6" />
              <div class="inline-toggle">
                <label for="cameraGizmo">Show Camera Gizmo</label>
                <button id="cameraGizmo" class="pill-toggle" type="button" data-state="off">Off</button>
              </div>
            </div>
            <div class="control rotation-group">
              <label>Camera Rotation</label>
              <div class="direction-3d">
                <div class="rotation-axis">
                  <span class="axis-label">X</span>
                  <div id="cameraRotXWheel" class="direction-wheel" role="slider" aria-label="Rotate camera X">
                    <div id="cameraRotXDot" class="direction-wheel-dot"></div>
                  </div>
                  <span class="direction-values"><span id="cameraRotXVal"></span></span>
                  <button id="cameraRotXReset" type="button" class="reset-btn direction-reset"></button>
                </div>
                <div class="rotation-axis">
                  <span class="axis-label">Y</span>
                  <div id="cameraRotYWheel" class="direction-wheel" role="slider" aria-label="Rotate camera Y">
                    <div id="cameraRotYDot" class="direction-wheel-dot"></div>
                  </div>
                  <span class="direction-values"><span id="cameraRotYVal"></span></span>
                  <button id="cameraRotYReset" type="button" class="reset-btn direction-reset"></button>
                </div>
                <div class="rotation-axis">
                  <span class="axis-label">Z</span>
                  <div id="cameraRotZWheel" class="direction-wheel" role="slider" aria-label="Rotate camera Z">
                    <div id="cameraRotZDot" class="direction-wheel-dot"></div>
                  </div>
                  <span class="direction-values"><span id="cameraRotZVal"></span></span>
                  <button id="cameraRotZReset" type="button" class="reset-btn direction-reset"></button>
                </div>
              </div>
            </div>
            <div class="control">
              <label>Depth of Field</label>
              <label for="focusDepth">Focus Distance <span id="focusDepthVal"></span></label>
              <input id="focusDepth" type="range" min="0" max="1" step="0.01" data-default="0.5" />
              <label for="aperture">Aperture (Blur Amount) <span id="apertureVal"></span></label>
              <input id="aperture" type="range" min="0" max="1" step="0.01" data-default="0.3" />
              <div class="inline-toggle">
                <label for="focusNavigator">Focus Navigator</label>
                <button id="focusNavigator" class="pill-toggle" type="button" data-state="off">Off</button>
              </div>
              <!-- Hidden legacy control for compatibility -->
              <input id="focusRange" type="hidden" value="0.8" />
            </div>
          </div>
        </div>
      </div>

      <div class="panel" data-panel="background">
        <div class="panel-header">
          <span>Background</span>
        </div>
        <div class="panel-content">
          <div class="control select-control">
            <label for="bgMode">Background Mode</label>
            <select id="bgMode">
              <option value="solid">Solid Color</option>
              <option value="linear">Linear Gradient</option>
              <option value="radial">Radial Gradient</option>
              <option value="transparent">Transparent</option>
            </select>
          </div>
          <div id="bgSolidControls" class="control" style="display: none;">
            <label for="bgSolidColor">Background Color</label>
            <input id="bgSolidColor" type="color" value="#000000" />
          </div>
	          <div id="bgGradientControls" class="control-stack" style="display: none;">
	            <div class="control">
	              <div class="inline-toggle">
	                <label for="bgGradientCanvas">Color Gradient</label>
	                <div class="mini-btn-group">
	                  <button type="button" class="mini-btn" data-gradient="bgGradientCanvas" data-action="add" aria-label="Add gradient point">+</button>
	                  <button type="button" class="mini-btn" data-gradient="bgGradientCanvas" data-action="remove" aria-label="Delete selected gradient point"></button>
	                </div>
	              </div>
	              <canvas id="bgGradientCanvas" class="gradient-editor" width="240" height="36"></canvas>
	            </div>
	          </div>
          <div id="bgLinearControls" class="control" style="display: none;">
            <label for="bgLinearDirection">Gradient Direction</label>
            <select id="bgLinearDirection">
              <option value="vertical">Vertical</option>
              <option value="horizontal">Horizontal</option>
            </select>
          </div>
          <div id="bgRadialControls" class="control-stack" style="display: none;">
            <div class="control">
              <label>Center Point</label>
              <label for="bgRadialCenterX">X <span id="bgRadialCenterXVal">0.5</span></label>
              <input id="bgRadialCenterX" type="range" min="0" max="1" step="0.01" value="0.5" />
              <label for="bgRadialCenterY">Y <span id="bgRadialCenterYVal">0.5</span></label>
              <input id="bgRadialCenterY" type="range" min="0" max="1" step="0.01" value="0.5" />
            </div>
          </div>
        </div>
      </div>

      <div class="panel" data-panel="animation">
        <div class="panel-header">
          <span>Animation</span>
        </div>
        <div class="panel-content">
          <!-- Emitter Animation -->
          <div class="control setting" id="emitterAnimSetting">
            <label>
              <span class="label-left">
                <button class="collapse-indicator"><span>+</span></button>
                Emitter Animation
              </span>
              <button id="emitterAnimEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
            </label>
            <div class="control-body" id="emitterAnimControls">
              <div class="control setting" id="emitterVelocitySetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Velocity Affected
                  </span>
                  <button id="emitterVelocityAffected" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="emitterVelocityAmount">Amount <span id="emitterVelocityAmountVal">1.0</span></label>
                  <input id="emitterVelocityAmount" type="range" min="0" max="3" step="0.1" value="1.0" />
                </div>
              </div>
              <div class="control setting" id="emitterAnimXSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    X Axis
                  </span>
                  <button id="emitterAnimX" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="emitterAnimXSpeed">Speed <span id="emitterAnimXSpeedVal">1.0</span></label>
                  <input id="emitterAnimXSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="emitterAnimXType">Motion Type</label>
                  <select id="emitterAnimXType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
              <div class="control setting" id="emitterAnimYSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Y Axis
                  </span>
                  <button id="emitterAnimY" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="emitterAnimYSpeed">Speed <span id="emitterAnimYSpeedVal">1.0</span></label>
                  <input id="emitterAnimYSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="emitterAnimYType">Motion Type</label>
                  <select id="emitterAnimYType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
              <div class="control setting" id="emitterAnimZSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Z Axis
                  </span>
                  <button id="emitterAnimZ" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="emitterAnimZSpeed">Speed <span id="emitterAnimZSpeedVal">1.0</span></label>
                  <input id="emitterAnimZSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="emitterAnimZType">Motion Type</label>
                  <select id="emitterAnimZType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Vortex Animation -->
          <div class="control setting" id="vortexAnimSetting">
            <label>
              <span class="label-left">
                <button class="collapse-indicator"><span>+</span></button>
                Vortex Animation
              </span>
              <button id="vortexAnimEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
            </label>
            <div class="control-body" id="vortexAnimControls">
              <div class="control setting" id="vortexAnimXSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    X Axis
                  </span>
                  <button id="vortexAnimX" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="vortexAnimXSpeed">Speed <span id="vortexAnimXSpeedVal">1.0</span></label>
                  <input id="vortexAnimXSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="vortexAnimXType">Motion Type</label>
                  <select id="vortexAnimXType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
              <div class="control setting" id="vortexAnimYSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Y Axis
                  </span>
                  <button id="vortexAnimY" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="vortexAnimYSpeed">Speed <span id="vortexAnimYSpeedVal">1.0</span></label>
                  <input id="vortexAnimYSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="vortexAnimYType">Motion Type</label>
                  <select id="vortexAnimYType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
              <div class="control setting" id="vortexAnimZSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Z Axis
                  </span>
                  <button id="vortexAnimZ" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="vortexAnimZSpeed">Speed <span id="vortexAnimZSpeedVal">1.0</span></label>
                  <input id="vortexAnimZSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="vortexAnimZType">Motion Type</label>
                  <select id="vortexAnimZType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- Attractor Animation -->
          <div class="control setting" id="attractorAnimSetting">
            <label>
              <span class="label-left">
                <button class="collapse-indicator"><span>+</span></button>
                Attractor Animation
              </span>
              <button id="attractorAnimEnabled" class="pill-toggle" type="button" data-state="off">Off</button>
            </label>
            <div class="control-body" id="attractorAnimControls">
              <div class="control setting" id="attractorAnimXSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    X Axis
                  </span>
                  <button id="attractorAnimX" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="attractorAnimXSpeed">Speed <span id="attractorAnimXSpeedVal">1.0</span></label>
                  <input id="attractorAnimXSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="attractorAnimXType">Motion Type</label>
                  <select id="attractorAnimXType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
              <div class="control setting" id="attractorAnimYSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Y Axis
                  </span>
                  <button id="attractorAnimY" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="attractorAnimYSpeed">Speed <span id="attractorAnimYSpeedVal">1.0</span></label>
                  <input id="attractorAnimYSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="attractorAnimYType">Motion Type</label>
                  <select id="attractorAnimYType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
              <div class="control setting" id="attractorAnimZSetting">
                <label>
                  <span class="label-left">
                    <button class="collapse-indicator"><span>+</span></button>
                    Z Axis
                  </span>
                  <button id="attractorAnimZ" class="pill-toggle" type="button" data-state="off">Off</button>
                </label>
                <div class="control-body">
                  <label for="attractorAnimZSpeed">Speed <span id="attractorAnimZSpeedVal">1.0</span></label>
                  <input id="attractorAnimZSpeed" type="range" min="0.1" max="5" step="0.1" value="1.0" />
                  <label for="attractorAnimZType">Motion Type</label>
                  <select id="attractorAnimZType">
                    <option value="sine">Sine</option>
                    <option value="bounce">Bounce</option>
                    <option value="noise">Noise</option>
                    <option value="random">Random</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel" data-panel="export">
        <div class="panel-header">
          <span>Export</span>
        </div>
        <div class="panel-content">
          <div class="control">
            <label>Video Recording</label>
            <label for="videoFormat">Format</label>
            <select id="videoFormat">
              <option value="webm">WebM (VP9)</option>
              <option value="mp4">MP4 (H.264)</option>
            </select>
            <button id="recordVideoBtn" class="export-btn" type="button">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="8"/>
              </svg>
              <span>Start Recording</span>
            </button>
            <div id="recordingStatus" class="export-status"></div>
          </div>
          <div class="control">
            <label>HTML Export</label>
            <div class="export-btn-row">
              <button id="exportHtmlBtn" class="export-btn" type="button">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                  <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="12" y1="18" x2="12" y2="12"/>
                  <line x1="9" y1="15" x2="15" y2="15"/>
                </svg>
                <span>HTML</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Focus Navigator Window -->
    <div id="focusNavigatorWindow" class="focus-navigator" style="display: none;">
      <div class="navigator-views">
        <button class="nav-view-btn active" data-view="top" title="Top View">T</button>
        <button class="nav-view-btn" data-view="left" title="Left View">L</button>
        <button class="nav-view-btn" data-view="right" title="Right View">R</button>
        <button class="nav-view-btn" data-view="bottom" title="Bottom View">B</button>
    </div>
      <canvas id="navigatorCanvas" width="200" height="200"></canvas>
    </div>

    <script type="module" src="./main.js"></script>
  </body>
</html>
